# 基于大语言模型的游戏NPC决策与交互系统

---

## 📑 目录 | Table of Contents

### 中文部分
- [项目简介](#项目简介)
- [支持Unity版本](#支持unity版本)
- [核心功能](#核心功能)
- [目前已实现部分](#目前已实现部分)
- [更新日志](#更新日志--update-log)
- [鸣谢与资源引用](#鸣谢与资源引用)
- [免责声明](#免责声明)

### 日本語部分
- [プロジェクト概要](#プロジェクト概要)
- [対応Unityバージョン](#対応unityバージョン)
- [主な機能](#主な機能)
- [実装済み機能](#実装済み機能)
- [更新履歴](#更新履歴--update-log-1)
- [謝辞・外部リソース](#謝辞外部リソース)
- [免責事項](#免責事項-1)

---

# 中文部分

---

## 项目简介

本课题旨在解决传统随机地牢游戏中 NPC 交互单一、行为固化、缺乏动态叙事的问题，探索将大语言模型（LLM）作为智能决策引擎，驱动 NPC 实现上下文感知的自然语言对话与动态行为。通过在 Unity 中构建 LLM 集成系统，赋予关键 NPC 情境化交互能力，验证其在提升叙事深度、交互多样性与玩家沉浸感方面的有效性。

---

## 支持Unity版本

Unity 2021.3.32f1c1

---

## 核心功能

### 一、LLM 驱动的 NPC 决策与交互核心模块

1. 角色敏感提示模板设计  
2. 结构化决策输出与容错机制  
3. 上下文闭环集成  
4. 对话反馈与剧情驱动机制  

---

### 二、随机地牢生成模块

1. 基于 BFS 算法的地牢生成  
2. 房间类型智能分配  
3. 地牢状态实时管理  

---

### 三、基础游戏与交互支撑模块

1. 玩家交互控制  
2. 战斗与事件响应  
3. 编辑器与可视化工具  
4. 系统集成与优化  

---

## 目前已实现部分

1. 开始游戏后自动生成一次地牢  
2. 地牢设定最远两个房间为出生点与Boss房  
3. 可通过 RoomsFirstDungeonGenerator 按钮测试地牢生成  
4. WASD 控制移动，战斗房间进入后限制离开（ESC 可退出战斗状态）  
5. 完成 LLM 与游戏系统的初步集成，实现 NPC 基础对话框架  

---

## 更新日志 | Update Log

- 26/2/22：完成核心地牢生成、房间类型分配、战斗状态基础逻辑；完成 LLM 与游戏系统的初步集成，搭建 NPC 对话交互框架  

---

## 鸣谢与资源引用

1. 地牢美术素材  
   https://pixel-poem.itch.io/dungeon-assetpuck  

2. 地牢生成算法参考教程  
   https://github.com/SunnyValleyStudio/Unity_2D_Procedural_Dungoen_Tutorial  

3. 角色美术素材  
   https://brullov.itch.io/generic-char-asset  

---

## 免责声明

1. 本项目仅用于学习、毕业设计与非商业用途。  
2. 外部素材请遵守原作者授权协议。  
3. 基于 Unity 2021.3.32f1c1 开发，其他版本可能存在兼容问题。  
4. 使用者自行承担使用风险。  
5. 二次分发请保留鸣谢信息。  

---

# 日本語部分

---

## プロジェクト概要

本課題は、従来のランダム生成型ダンジョンゲームにおけるNPCインタラクションの単一性、行動の固定化、および動的ナラティブの欠如という課題を解決することを目的とする。

本研究では、大規模言語モデル（LLM）を知的意思決定エンジンとして導入し、NPCに文脈認識型の自然言語対話および動的行動生成能力を付与する。Unity環境においてLLM統合システムを構築し、主要NPCに状況依存型インタラクションを実装することで、物語性の深化、対話多様性の向上、およびプレイヤー没入感の強化に対する有効性を検証する。

---

## 対応Unityバージョン

Unity 2021.3.32f1c1

---

## 主な機能

### LLM駆動NPC意思決定・対話コアモジュール

1. キャラクター特性を考慮したプロンプト設計  
2. 構造化意思決定出力とフォールトトレランス機構  
3. コンテキスト循環統合アーキテクチャ  
4. 対話フィードバックとナラティブ駆動機構  

---

### ランダムダンジョン生成モジュール

1. BFSアルゴリズムに基づくダンジョン生成  
2. 部屋タイプの動的割り当て  
3. ダンジョン状態管理  

---

### 基礎ゲーム支援モジュール

1. プレイヤー移動制御  
2. バトル状態管理  
3. エディタ拡張および可視化ツール  
4. システム統合・最適化  

---

## 実装済み機能

1. ゲーム開始時にダンジョンを自動生成  
2. 最長距離の2部屋を開始地点とボスルームに設定  
3. 生成テストおよびアイテム配置確認機能  
4. バトルルーム進入時の退出制限（ESC解除）  
5. LLM統合およびNPC対話基盤の構築  

---

## 更新履歴 | Update Log

- 26/2/22：コアダンジョン生成、部屋割当、バトル基礎ロジック実装；LLM統合およびNPC対話フレームワーク構築  

---

## 謝辞・外部リソース

1. ダンジョン素材  
   https://pixel-poem.itch.io/dungeon-assetpuck  

2. ダンジョン生成参考  
   https://github.com/SunnyValleyStudio/Unity_2D_Procedural_Dungoen_Tutorial  

3. キャラクター素材  
   https://brullov.itch.io/generic-char-asset  

---

## 免責事項

1. 本プロジェクトは学習・卒業設計および非商用目的に限定。  
2. 外部素材は各ライセンスに従うこと。  
3. Unity 2021.3.32f1c1 にて動作確認済み。  
4. 利用に伴う損害について作者は責任を負わない。  
5. 再配布時は謝辞を保持すること。  

---