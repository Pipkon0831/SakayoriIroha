# 基于大语言模型的游戏NPC决策与交互系统

---

## 📑 目录 | Table of Contents

### 中文
- [项目背景](#项目背景)
- [项目简介](#项目简介)
- [支持Unity版本](#支持unity版本)
- [核心功能](#核心功能)
- [目前已实现部分](#目前已实现部分)
- [更新日志](#更新日志--update-log)
- [鸣谢与资源引用](#鸣谢与资源引用)
- [免责声明](#免责声明)

### 日本語
- [プロジェクト背景](#プロジェクト背景)
- [プロジェクト概要](#プロジェクト概要)
- [対応Unityバージョン](#対応unityバージョン)
- [主な機能](#主な機能)
- [実装済み機能](#実装済み機能)
- [更新履歴](#更新履歴--update-log)
- [謝辞・外部リソース](#謝辞外部リソース)
- [免責事項](#免責事項)

---

## 项目背景

本项目为河南农业大学计算机科学与技术（软件技术方向）专业某本科学生的毕业设计课题。项目围绕大语言模型（LLM）在游戏NPC智能决策与交互系统中的应用展开，旨在通过系统构建与实验验证，探索其在动态叙事生成、情境感知交互以及游戏智能体行为生成方面的可行性与实现路径。

---

## 项目简介

本课题聚焦于传统随机生成型地牢游戏中 NPC 依赖预设脚本、交互形式单一、行为固化以及缺乏动态叙事能力等问题。为此，引入大语言模型（LLM）作为智能决策引擎，为 NPC 赋予上下文感知的自然语言对话能力与动态行为生成能力。在 Unity 环境中构建 LLM 集成系统，并为关键 NPC 实现情境依赖型交互机制，从而验证该方法在提升叙事深度、交互多样性以及玩家沉浸感方面的有效性。

---

## 支持Unity版本

Unity 2021.3.32f1c1

---

## 核心功能

### 一、LLM 驱动的 NPC 决策与交互核心模块

1. 角色敏感提示模板设计  
2. 结构化决策输出与容错机制  
3. 上下文闭环集成  
4. 对话反馈与事件驱动机制  

---

### 二、随机地牢生成模块

1. 基于 BFS 算法的地牢生成  
2. 房间类型智能分配  
3. 地牢状态实时管理  

---

### 三、基础游戏与交互支撑模块

1. 玩家交互控制  
2. 战斗与事件响应  
3. 编辑器与可视化工具  
4. 系统集成与优化  

---

## 目前已实现部分

1. 开始游戏后自动生成一次地牢  
2. 地牢设定最远两个房间为出生点与Boss房  
3. 可通过 RoomsFirstDungeonGenerator 按钮测试地牢生成  
4. WASD 控制移动，进入战斗房间后自动进入战斗状态，清空当前房间怪物后自动退出战斗  
5. 完成基础战斗系统与武器系统架构，实现房间怪物实时检测机制、BaseWeapon + WeaponManager 武器管理结构、基础手枪与子弹逻辑，以及 Boss 房通关后延迟自动重生地牢机制  
6. 完成简易怪物AI系统（闲置游走、玩家追击、攻击判定），新增死亡状态标记防止重复触发逻辑  
7. 完善游戏生命周期管理，新增玩家死亡判定、暂停逻辑与死亡UI触发机制  
8. 构建LLM接入底层架构：实现战斗倍率系统（玩家/敌人伤害/攻速/移速等）、事件系统（区分临时/长期事件）、LLM事件桥接层，支持事件与战斗倍率的联动映射  
9. 完成完整事件闭环构建：UI / JSON → LayerEventSystem → Commit → Apply → FloorEnd，经过多轮测试验证生命周期稳定  

---

## 更新日志 | Update Log

- 26/2/22：完成核心地牢生成、房间类型分配、战斗状态基础逻辑。
- 26/2/23：重构战斗退出逻辑（由ESC手动退出改为清怪自动退出）；实现房间怪物实时检测机制；完成基础武器系统架构（BaseWeapon + WeaponManager）；实现基础手枪与子弹系统；新增 Boss 房通关后延迟自动重生地牢功能。
- 26/2/24：实现完整怪物AI逻辑（闲置游走、追击、攻击、分离）；完善游戏生命周期（玩家死亡判定、暂停、死亡UI）；新增LLM接入底层核心系统（CombatModifierSystem/LayerEventSystem等），区分临时/长期事件类型，完成事件与战斗数值的联动映射，为LLM接入奠定架构基础。
- 26/2/25：完成全部事件接口构建与 JSON 模拟 LLM 输入系统；实现三层事件结构；完成多层连续测试。


---

## 鸣谢与资源引用

1. 地牢美术素材  
   https://pixel-poem.itch.io/dungeon-assetpuck  

2. 地牢生成算法参考教程  
   https://github.com/SunnyValleyStudio/Unity_2D_Procedural_Dungoen_Tutorial  

3. 角色美术素材  
   https://brullov.itch.io/generic-char-asset  

---

## 免责声明

1. 本项目仅用于学习、毕业设计与非商业用途。  
2. 外部素材请遵守原作者授权协议。  
3. 基于 Unity 2021.3.32f1c1 开发，其他版本可能存在兼容问题。  
4. 使用者自行承担使用风险。  
5. 二次分发请保留鸣谢信息。  

---

# 大規模言語モデルに基づくゲームNPCの意思決定および対話システム

---

## プロジェクト背景

本プロジェクトは、河南農業大学（中国・河南省）コンピュータサイエンス専攻（ソフトウェア技術方向）に在籍する学士課程学生の卒業研究課題として実施されるものである。大規模言語モデル（LLM）をゲームNPCの意思決定および対話システムへ応用することを目的とし、動的ナラティブ生成、文脈認識型インタラクション、およびゲームエージェント行動生成の実装可能性について体系的に検証する。

---

## プロジェクト概要

本課題は、従来のランダム生成型ダンジョンゲームにおいてNPCが事前定義スクリプトに依存し、インタラクションの単一性や行動の固定化、動的ナラティブの欠如といった課題を抱えている点に着目する。そこで、大規模言語モデル（LLM）を知的意思決定エンジンとして導入し、NPCに文脈認識型の自然言語対話および動的行動生成能力を付与する。Unity環境においてLLM統合システムを構築し、主要NPCに状況依存型インタラクションを実装することで、物語性の深化、対話多様性の向上、およびプレイヤー没入感の強化に対する有効性を検証する。

---

## 対応Unityバージョン

Unity 2021.3.32f1c1

---

## 主な機能

### LLM駆動NPC意思決定・対話コアモジュール

1. キャラクター特性を考慮したプロンプト設計  
2. 構造化意思決定出力とフォールトトレランス機構  
3. コンテキスト循環統合アーキテクチャ  
4. 対話フィードバックとイベント駆動機構  

---

### ランダムダンジョン生成モジュール

1. BFSアルゴリズムに基づくダンジョン生成  
2. 部屋タイプの動的割り当て  
3. ダンジョン状態管理  

---

### 基礎ゲーム支援モジュール

1. プレイヤー移動制御  
2. バトル状態管理  
3. エディタ拡張および可視化ツール  
4. システム統合・最適化  

---

## 実装済み機能

1. ゲーム開始後にダンジョンを自動生成  
2. ダンジョン内で最も距離の離れた2つの部屋を開始地点およびBossルームとして設定  
3. RoomsFirstDungeonGenerator ボタンからダンジョン生成テストが可能  
4. WASDキーで移動し、戦闘ルーム進入時に自動で戦闘状態へ移行、当該ルーム内の敵を全滅させると自動的に戦闘状態を解除  
5. 基本戦闘システムおよび武器システムアーキテクチャを実装し、部屋内敵リアルタイム検出機構、BaseWeapon + WeaponManager による武器管理構造、基本ピストルおよび弾丸ロジック、Bossルーム通関後の遅延ダンジョン自動再生成機能を構築  
6. 簡易敵AIシステムを実装（待機時遊走、プレイヤー追跡、攻撃判定）、死亡状態フラグを追加し死亡ロジックの重複トリガーを防止  
7. ゲームライフサイクル管理を完善し、プレイヤー死亡判定、一時停止ロジック、死亡UIトリガー機構を追加  
8. LLM統合の基盤アーキテクチャを構築：戦闘倍率システム（プレイヤー／敵のダメージ・攻撃速度・移動速度等）、イベントシステム（一時イベント／長期イベントの区分）、LLMイベントブリッジレイヤーを実装し、イベントと戦闘倍率の連動マッピングを実現  
9. 完整なイベント閉環を構築：UI / JSON → LayerEventSystem → Commit → Apply → FloorEnd のフローを実装し、複数回のテストを経てライフサイクルの安定性を検証  

---

## 更新履歴 | Update Log

- 26/2/22：コアダンジョン生成、部屋タイプ割当、戦闘状態の基礎ロジックを実装。  
- 26/2/23：戦闘終了ロジックをESC手動解除方式から敵全滅による自動解除方式へ変更；部屋内敵リアルタイム検出機構を実装；基本武器システムアーキテクチャ（BaseWeapon + WeaponManager）を構築；基本ピストルおよび弾丸システムを実装；Bossルーム通関後の遅延ダンジョン自動再生成機能を追加。  
- 26/2/24：敵AIの完全ロジック（待機時遊走、追跡、攻撃、分離）を実装；ゲームライフサイクル（プレイヤー死亡判定、一時停止、死亡UI）を完善；LLM統合の基盤コアシステム（CombatModifierSystem / LayerEventSystem 等）を追加し、一時／長期イベントタイプを区分、イベントと戦闘数値の連動マッピングを完成、LLM統合の基盤を構築。  
- 26/2/25：全イベントインターフェースを構築；JSONによるLLM入力シミュレーションシステムを実装；三層構造イベントシステムを構築；多層連続テストを完了。  


---

## 謝辞・外部リソース

1. ダンジョン素材  
   https://pixel-poem.itch.io/dungeon-assetpuck  

2. ダンジョン生成参考  
   https://github.com/SunnyValleyStudio/Unity_2D_Procedural_Dungoen_Tutorial  

3. キャラクター素材  
   https://brullov.itch.io/generic-char-asset  

---

## 免責事項

1. 本プロジェクトは学習・卒業設計および非商用目的に限定。  
2. 外部素材は各ライセンスに従うこと。  
3. Unity 2021.3.32f1c1 にて動作確認済み。  
4. 利用に伴う損害について作者は責任を負わない。  
5. 再配布時は謝辞を保持すること。  

---